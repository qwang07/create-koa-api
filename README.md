# Create Koa API

ä¸€ä¸ªåŸºäº Koa.js çš„ç°ä»£åŒ– API è„šæ‰‹æ¶ï¼Œæä¾›å®Œæ•´çš„é¡¹ç›®ç»“æ„å’Œæœ€ä½³å®è·µã€‚

## ç‰¹æ€§

- ğŸš€ ç°ä»£åŒ–çš„ ES6+ è¯­æ³•
- ğŸ“ æ¸…æ™°çš„é¡¹ç›®ç»“æ„å’Œè·¯ç”±ç»„ç»‡
- ğŸ›¡ï¸ å†…ç½®å®‰å…¨é˜²æŠ¤ï¼ˆCORSã€Helmetã€Rate Limitï¼‰
- ğŸ“ è‡ªåŠ¨ç”Ÿæˆ Swagger API æ–‡æ¡£
- ğŸ” è¯¦ç»†çš„è¯·æ±‚æ—¥å¿—è®°å½•
- ğŸ¯ ç»Ÿä¸€çš„é”™è¯¯å¤„ç†å’Œå“åº”æ ¼å¼
- âœ… å®Œæ•´çš„æµ‹è¯•æ”¯æŒ

## å¿«é€Ÿå¼€å§‹

### å®‰è£…

```bash
# ä½¿ç”¨ npx åˆ›å»ºé¡¹ç›®
npx create-koa-api my-api

# è¿›å…¥é¡¹ç›®ç›®å½•
cd my-api

# å®‰è£…ä¾èµ–
pnpm install
```

### å¼€å‘

```bash
# å¼€å‘æ¨¡å¼
pnpm dev

# ç”Ÿäº§æ¨¡å¼
pnpm start

# è¿è¡Œæµ‹è¯•
pnpm test
```

### ç¯å¢ƒå˜é‡

åˆ›å»º `.env` æ–‡ä»¶ï¼š

```env
NODE_ENV=development
PORT=3000
LOG_LEVEL=info
ENABLE_FILE_LOGGING=false
LOG_DIR=logs
```

## é¡¹ç›®ç»“æ„

```
.
â”œâ”€â”€ bin/                # å¯åŠ¨è„šæœ¬
â”‚   â”œâ”€â”€ cli.js         # CLI å·¥å…·
â”‚   â””â”€â”€ www.js         # æœåŠ¡å™¨å¯åŠ¨æ–‡ä»¶
â”œâ”€â”€ components/         # ä¸šåŠ¡ç»„ä»¶
â”‚   â””â”€â”€ users/         # ç”¨æˆ·æ¨¡å—
â”‚       â”œâ”€â”€ create.js  # åˆ›å»ºç”¨æˆ·
â”‚       â”œâ”€â”€ delete.js  # åˆ é™¤ç”¨æˆ·
â”‚       â”œâ”€â”€ get.js     # è·å–ç”¨æˆ·
â”‚       â”œâ”€â”€ list.js    # ç”¨æˆ·åˆ—è¡¨
â”‚       â”œâ”€â”€ update.js  # æ›´æ–°ç”¨æˆ·
â”‚       â”œâ”€â”€ schema.js  # éªŒè¯è§„åˆ™
â”‚       â””â”€â”€ data.js    # æ•°æ®å­˜å‚¨
â”œâ”€â”€ lib/               # å·¥å…·åº“
â”‚   â””â”€â”€ logger.js      # æ—¥å¿—å·¥å…·
â”œâ”€â”€ middlewares/       # ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ bodyParser.js  # è¯·æ±‚ä½“è§£æ
â”‚   â”œâ”€â”€ cors.js        # CORS é…ç½®
â”‚   â”œâ”€â”€ helmet.js      # å®‰å…¨å¤´é…ç½®
â”‚   â”œâ”€â”€ responseHandler.js  # å“åº”å¤„ç†
â”‚   â”œâ”€â”€ router.js      # è·¯ç”±åŠ è½½å™¨
â”‚   â”œâ”€â”€ security.js    # å®‰å…¨ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ swagger.js     # API æ–‡æ¡£
â”‚   â””â”€â”€ validator.js   # è¯·æ±‚éªŒè¯
â”œâ”€â”€ test/              # æµ‹è¯•æ–‡ä»¶
â”‚   â””â”€â”€ users.test.js  # ç”¨æˆ·æ¨¡å—æµ‹è¯•
â”œâ”€â”€ .env               # ç¯å¢ƒå˜é‡
â”œâ”€â”€ .gitignore
â”œâ”€â”€ app.js            # åº”ç”¨å…¥å£
â”œâ”€â”€ package.json
â””â”€â”€ README.md
```

## API ç¤ºä¾‹

### ç”¨æˆ·æ¨¡å—

```javascript
// è·å–ç”¨æˆ·åˆ—è¡¨
GET /users

// è·å–å•ä¸ªç”¨æˆ·
GET /users/:id

// åˆ›å»ºç”¨æˆ·
POST /users
{
  "name": "John Doe",
  "email": "john@example.com"
}

// æ›´æ–°ç”¨æˆ·
PUT /users/:id
{
  "name": "John Doe",
  "email": "john@example.com"
}

// åˆ é™¤ç”¨æˆ·
DELETE /users/:id
```

## ä¸­é—´ä»¶é¡ºåº

1. responseHandler - å“åº”å¤„ç†ï¼ˆåŒ…å«é”™è¯¯å¤„ç†å’Œæ—¥å¿—ï¼‰
2. helmet - å®‰å…¨å¤´
3. cors - è·¨åŸŸæ”¯æŒ
4. bodyParser - è¯·æ±‚ä½“è§£æ
5. rateLimiter - é™æµä¿æŠ¤
6. routes - ä¸šåŠ¡è·¯ç”±

## æœ€ä½³å®è·µ

1. è·¯ç”±ç»„ç»‡
   - æ¯ä¸ªè·¯ç”±æ–‡ä»¶åªå¤„ç†ä¸€ä¸ªç«¯ç‚¹
   - ä½¿ç”¨ schema.js é›†ä¸­ç®¡ç†éªŒè¯è§„åˆ™
   - ä½¿ç”¨ data.js ç®¡ç†æ¨¡å—æ•°æ®

2. é”™è¯¯å¤„ç†
   - ä½¿ç”¨ ctx.throw() æŠ›å‡ºé”™è¯¯
   - é”™è¯¯ä¼šè¢«è‡ªåŠ¨æ•è·å¹¶æ ¼å¼åŒ–
   - ç”Ÿäº§ç¯å¢ƒä¸æš´éœ²é”™è¯¯å †æ ˆ

3. æ—¥å¿—è®°å½•
   - è‡ªåŠ¨è®°å½•è¯·æ±‚å’Œå“åº”
   - æ”¯æŒæ§åˆ¶å°å’Œæ–‡ä»¶æ—¥å¿—
   - å¯é…ç½®çš„æ—¥å¿—çº§åˆ«

4. å®‰å…¨æ€§
   - é»˜è®¤å¯ç”¨å®‰å…¨å¤´
   - é…ç½®åˆç†çš„ CORS è§„åˆ™
   - å†…ç½®é™æµä¿æŠ¤

## License

MIT
